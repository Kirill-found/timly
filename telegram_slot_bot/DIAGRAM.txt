╔═══════════════════════════════════════════════════════════════════════════╗
║                    TELEGRAM SLOT BOT - АРХИТЕКТУРА                        ║
╚═══════════════════════════════════════════════════════════════════════════╝


┌─────────────────────────────────────────────────────────────────────────┐
│                          СТРУКТУРА ПРОЕКТА                              │
└─────────────────────────────────────────────────────────────────────────┘

telegram_slot_bot/
│
├── 📄 ОСНОВНЫЕ ФАЙЛЫ
│   ├── bot.py                  ⭐ Главный файл (команды, платежи)
│   ├── models.py               🗄️ Модели PostgreSQL
│   ├── database.py             💾 Работа с БД
│   ├── game_logic.py           🎰 Игровая логика
│   ├── achievements.py         🏆 Система достижений
│   └── dice_tester.py          🧪 Тестирование Dice API
│
├── ⚙️ КОНФИГУРАЦИЯ
│   ├── .env                    🔐 Настройки (НЕ коммитить!)
│   ├── .env.example            📋 Пример настроек
│   ├── requirements.txt        📦 Зависимости Python
│   └── .gitignore              🚫 Игнорируемые файлы
│
└── 📚 ДОКУМЕНТАЦИЯ
    ├── README.md               📖 Полная документация
    ├── ПОШАГОВАЯ_ИНСТРУКЦИЯ.md 🎯 Детальная инструкция
    ├── БЫСТРЫЙ_СТАРТ.txt       ⚡ Краткая памятка
    ├── QUICKSTART.md           🚀 Быстрый старт
    ├── CHEATSHEET.md           📝 Шпаргалка
    ├── PROJECT_STRUCTURE.md    🏗️ Структура проекта
    ├── API_EXAMPLES.md         💻 Примеры кода
    └── DIAGRAM.txt             📊 Эта диаграмма


┌─────────────────────────────────────────────────────────────────────────┐
│                         ПОТОК ДАННЫХ - СПИН                             │
└─────────────────────────────────────────────────────────────────────────┘

   Пользователь
        │
        │ /spin
        ▼
   ┌──────────┐
   │  bot.py  │ ◄──── Обработка команды
   └────┬─────┘
        │
        │ 1. Проверка баланса
        ▼
   ┌──────────────┐
   │ database.py  │ ◄──── user.balance >= 35?
   └──────┬───────┘
          │ ✅ OK
          │
          │ 2. Списание ставки
          ▼
   ┌──────────────┐
   │ database.py  │ ◄──── update_balance(-35)
   └──────────────┘
          │
          │ 3. Отправка dice
          ▼
   ┌──────────────────┐
   │  Telegram API    │ ◄──── send_dice(🎰)
   └────────┬─────────┘
            │
            │ dice_value (1-64)
            ▼
   ┌──────────────────┐
   │  game_logic.py   │ ◄──── check_win(dice_value)
   └────────┬─────────┘
            │
            ├──── ❌ Проигрыш
            │
            └──── ✅ Выигрыш
                  │
                  │ 4. Начисление выигрыша
                  ▼
            ┌──────────────┐
            │ database.py  │ ◄──── update_balance(+payout)
            └──────┬───────┘
                   │
                   │ 5. Логирование
                   ▼
            ┌──────────────┐
            │ database.py  │ ◄──── log_transaction()
            └──────┬───────┘
                   │
                   │ 6. Проверка достижений
                   ▼
            ┌─────────────────┐
            │ achievements.py │ ◄──── check_and_unlock()
            └────────┬────────┘
                     │
                     │ Ответ пользователю
                     ▼
                Пользователь


┌─────────────────────────────────────────────────────────────────────────┐
│                      ПОТОК ДАННЫХ - ПОКУПКА ЗВЁЗД                       │
└─────────────────────────────────────────────────────────────────────────┘

   Пользователь
        │
        │ /buy
        ▼
   ┌──────────┐
   │  bot.py  │ ◄──── buy_command() - показ пакетов
   └────┬─────┘
        │
        │ Inline кнопки
        ▼
   Пользователь нажимает на пакет
        │
        │ callback_data: "buy_1000"
        ▼
   ┌──────────┐
   │  bot.py  │ ◄──── buy_callback() - создание invoice
   └────┬─────┘
        │
        │ send_invoice()
        ▼
   ┌──────────────────┐
   │  Telegram Stars  │ ◄──── Форма оплаты
   └────────┬─────────┘
            │
            │ Пользователь оплачивает
            ▼
   ┌──────────┐
   │  bot.py  │ ◄──── precheckout_callback() - валидация
   └────┬─────┘
        │ ✅ OK
        │
        │ Оплата прошла
        ▼
   ┌──────────┐
   │  bot.py  │ ◄──── successful_payment_callback()
   └────┬─────┘
        │
        │ 1. Создать запись
        ▼
   ┌──────────────┐
   │ database.py  │ ◄──── create_payment()
   └──────┬───────┘
          │
          │ 2. Завершить платёж
          ▼
   ┌──────────────┐
   │ database.py  │ ◄──── complete_payment() - начисление звёзд
   └──────┬───────┘
          │
          │ Подтверждение
          ▼
      Пользователь


┌─────────────────────────────────────────────────────────────────────────┐
│                        БАЗА ДАННЫХ - ТАБЛИЦЫ                            │
└─────────────────────────────────────────────────────────────────────────┘

    users                transactions           achievements
  ┌─────────┐           ┌──────────────┐      ┌──────────────┐
  │ user_id │◄──────────│ user_id      │      │ id           │
  │ username│           │ type         │      │ code         │
  │ balance │           │ amount       │      │ title        │
  │ spins   │           │ dice_value   │      │ reward       │
  │ ...     │           │ ...          │      │ ...          │
  └────┬────┘           └──────────────┘      └──────┬───────┘
       │                                             │
       │                                             │
       │               user_achievements             │
       │              ┌──────────────┐               │
       └──────────────│ user_id      │               │
                      │ achievement_id├───────────────┘
                      │ unlocked_at  │
                      └──────────────┘

    payments              game_stats         dice_value_mappings
  ┌──────────────┐      ┌──────────────┐    ┌──────────────────┐
  │ id           │      │ date         │    │ dice_value       │
  │ user_id      │      │ total_users  │    │ combination      │
  │ tg_charge_id │      │ total_spins  │    │ is_win           │
  │ tg_stars     │      │ actual_rtp   │    │ occurrence_count │
  │ game_stars   │      │ ...          │    │ ...              │
  └──────────────┘      └──────────────┘    └──────────────────┘


┌─────────────────────────────────────────────────────────────────────────┐
│                        КОМАНДЫ БОТА                                     │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────┐  ┌─────────────────────────┐
│   ПОЛЬЗОВАТЕЛЬСКИЕ      │  │      АДМИНСКИЕ          │
├─────────────────────────┤  ├─────────────────────────┤
│ /start        Начать    │  │ /adminstats  Статистика │
│ /spin         Крутить   │  │ /ban         Забанить   │
│ /balance      Баланс    │  │ /unban       Разбанить  │
│ /stats        Статистика│  │ /givestars   Дать звёзды│
│ /achievements Достижения│  └─────────────────────────┘
│ /top          Топ-10    │
│ /buy          Купить    │  ┌─────────────────────────┐
│ /help         Справка   │  │   ТЕСТИРОВАНИЕ          │
└─────────────────────────┘  ├─────────────────────────┤
                             │ /test        Тест dice  │
                             │ /analyze     Анализ     │
                             │ /export      Экспорт    │
                             │ /resetstats  Сброс      │
                             └─────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────┐
│                          ДОСТИЖЕНИЯ (16)                                │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   ИГРОВЫЕ       │  │    ПОБЕДНЫЕ     │  │  ФИНАНСОВЫЕ     │
├─────────────────┤  ├─────────────────┤  ├─────────────────┤
│ 🎰 Первый спин  │  │ 🎉 Первая победа│  │ 💸 Щедрый       │
│ 🌟 Новичок      │  │ 🍀 Везунчик     │  │ 💰 Магнат       │
│ ⭐ Опытный      │  │ 🎊 Счастливчик  │  │ 🤑 Богач        │
│ 💫 Ветеран      │  │ 💎 Джекпот      │  │ 👑 Миллионер    │
│                 │  │ 🔥 Большой куш  │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘

┌──────────────────────────────────────┐
│          МЕТА-ДОСТИЖЕНИЯ             │
├──────────────────────────────────────┤
│ 📅 Преданный      7 дней подряд      │
│ 🏆 Охотник        5 достижений       │
│ 📚 Коллекционер   Все достижения     │
└──────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────┐
│                      ТАБЛИЦА ВЫПЛАТ                                     │
└─────────────────────────────────────────────────────────────────────────┘

  Комбинация     Выплата      RTP вклад
  ──────────────────────────────────────
  🍒🍒🍒           100 ⭐        ~2.86x
  🍋🍋🍋           200 ⭐        ~5.71x
  🍇🍇🍇           350 ⭐       ~10.00x
  7️⃣7️⃣7️⃣           500 ⭐       ~14.29x

  Стоимость спина: 35 ⭐


┌─────────────────────────────────────────────────────────────────────────┐
│                   ПАКЕТЫ TELEGRAM STARS                                 │
└─────────────────────────────────────────────────────────────────────────┘

  Игровые звёзды    →    Telegram Stars
  ──────────────────────────────────────
       100 ⭐        →       10 ⭐
       500 ⭐        →       50 ⭐
      1000 ⭐        →      100 ⭐
      5000 ⭐        →      500 ⭐
     10000 ⭐        →     1000 ⭐


┌─────────────────────────────────────────────────────────────────────────┐
│                      ТЕХНОЛОГИЧЕСКИЙ СТЕК                               │
└─────────────────────────────────────────────────────────────────────────┘

  ┌──────────────────┐
  │   Frontend       │
  │   (Telegram)     │
  └────────┬─────────┘
           │
           │ python-telegram-bot
           ▼
  ┌──────────────────┐
  │   Backend        │
  │   (Python 3.8+)  │
  ├──────────────────┤
  │ • bot.py         │
  │ • game_logic.py  │
  │ • achievements.py│
  └────────┬─────────┘
           │
           │ SQLAlchemy
           ▼
  ┌──────────────────┐
  │   Database       │
  │   (PostgreSQL)   │
  └──────────────────┘


┌─────────────────────────────────────────────────────────────────────────┐
│                          ДЕПЛОЙ                                         │
└─────────────────────────────────────────────────────────────────────────┘

  ┌────────────┐     ┌────────────┐     ┌────────────┐
  │    VPS     │     │   Docker   │     │   Heroku   │
  ├────────────┤     ├────────────┤     ├────────────┤
  │ systemd    │     │ compose    │     │ Procfile   │
  │ PostgreSQL │     │ PostgreSQL │     │ PostgreSQL │
  │ Python     │     │ Python     │     │ Python     │
  └────────────┘     └────────────┘     └────────────┘


╔═══════════════════════════════════════════════════════════════════════════╗
║                         ГОТОВО К ЗАПУСКУ! 🚀                              ║
╚═══════════════════════════════════════════════════════════════════════════╝
